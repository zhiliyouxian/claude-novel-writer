---
name: nw-bp-plan
description: 生成蓝图（策划阶段）。用法: /nw-bp-plan [pool_name] <类型> <流派>
---

# 蓝图生成命令

一键生成完整的小说蓝图，包括选题方案、世界观、角色档案和章节大纲。

执行此命令后进入**蓝图阶段**，后续对话可直接讨论蓝图修改，无需重复输入命令。

## 用法

```bash
/nw-bp-plan [pool_name] <类型> <流派>
```

## 示例

```bash
# 基于素材池生成蓝图
/nw-bp-plan xuanhuan_1 玄幻 废柴流

# 不使用素材池，直接生成
/nw-bp-plan 玄幻 系统流

# 指定更多关键词
/nw-bp-plan 都市 重生 复仇

# 英文关键词也支持
/nw-bp-plan fantasy hero's-journey
```

## 参数说明

| 参数 | 必填 | 说明 |
|------|------|------|
| pool_name | 可选 | 素材池名称，用于参考风格 |
| 类型 | 必填 | 题材类型（玄幻/仙侠/都市/科幻等） |
| 流派 | 必填 | 流派关键词（废柴流/系统流/重生等） |

## 功能

此命令会依次调用 4 个 Agent 生成完整蓝图：

1. **选题方案** (proposal.md)
   - 3 个备选方案
   - 每个方案包含：核心设定、金手指、5大阶段

2. **世界观设定** (worldview.md)
   - 力量体系（境界划分）
   - 势力格局
   - 地理设定
   - 核心规则

3. **角色档案** (characters.md)
   - 主角详细设定
   - 女主/红颜 2-4人
   - 主要反派 3-5人
   - 重要配角 10+人

4. **章节大纲** (outline.md)
   - 200-300章完整大纲
   - 每章包含：标题、核心情节、爽点、钩子
   - 5大阶段篇幅分配

## 执行流程

```
用户输入: /nw-bp-plan xuanhuan_1 玄幻 废柴流
  ↓
确定 project_id:
  ├─ 如果用户指定项目名 → 使用指定名
  └─ 否则 → 自动生成（如 xuanhuan_001）
  ↓
读取参考风格（可选）:
  pools/analysis/xuanhuan_1/style-fusion.md
  ↓
加载知识库:
  ├─ libraries/knowledge/_base/ (通用知识)
  └─ libraries/knowledge/chinese-webnovel/ (匹配"玄幻")
  ↓
调用 Agents（顺序执行）:
  1. 生成选题方案 → blueprints/{project_id}/proposal.md
  2. 用户选择方案（或自动选择方案1）
  3. 生成世界观 → blueprints/{project_id}/worldview.md
  4. 生成角色档案 → blueprints/{project_id}/characters.md
  5. 生成章节大纲 → blueprints/{project_id}/outline.md
  ↓
完成:
  ├─ 输出蓝图摘要
  └─ 提示下一步操作
```

## 输出示例

```
开始生成蓝图: 玄幻 废柴流
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 项目信息
  project_id: xuanhuan_001
  参考风格: pools/analysis/xuanhuan_1/style-fusion.md
  知识库: _base + chinese-webnovel

📝 [1/4] 生成选题方案...
  ✓ 方案1: 《万古签到系统》- 签到流 + 废柴逆袭
  ✓ 方案2: 《吞噬星空》- 异能觉醒 + 宇宙探索
  ✓ 方案3: 《一念永恒》- 废柴流 + 搞笑风格

  已自动选择: 方案1

🌍 [2/4] 生成世界观...
  ✓ 力量体系: 炼气→筑基→金丹→元婴→化神→大乘→渡劫
  ✓ 势力格局: 3宗5派 + 世家 + 魔门
  ✓ 地理设定: 东玄域 → 中州 → 天外天

👥 [3/4] 生成角色档案...
  ✓ 主角: 萧羽 (废柴少年，签到系统)
  ✓ 女主: 柳如烟、云瑶 (2人)
  ✓ 反派: 李傲天、云家老祖、魔帝 (5人)
  ✓ 配角: 15人

📖 [4/4] 生成章节大纲...
  ✓ 第一阶段: 1-40章 (崛起之路)
  ✓ 第二阶段: 41-80章 (磨练成长)
  ✓ 第三阶段: 81-120章 (三年之约)
  ✓ 第四阶段: 121-170章 (中州争锋)
  ✓ 第五阶段: 171-210章 (巅峰对决)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 蓝图生成完成!

蓝图位置:
blueprints/xuanhuan_001/
├─ proposal.md      # 选题方案
├─ worldview.md     # 世界观设定
├─ characters.md    # 角色档案
└─ outline.md       # 210章大纲

下一步:
1. 查看并调整蓝图文件
2. 审核蓝图: /nw-bp-audit
3. 开始创作: /nw-ch-write 1-10
```

## 交互模式

### 选择方案

默认自动选择方案1，也可以交互选择：

```
📝 生成了3个选题方案:

方案1: 《万古签到系统》
  签到流 + 废柴逆袭，节奏快，爽点密集

方案2: 《吞噬星空》
  异能觉醒 + 宇宙探索，格局大，世界观宏大

方案3: 《一念永恒》
  废柴流 + 搞笑风格，轻松向，适合轻松阅读

选择方案 [1/2/3]:
```

### 指定项目名

```bash
# 自动生成 project_id
/nw-bp-plan 玄幻 废柴流
# → project_id: xuanhuan_001

# 指定项目名
"创作《纵横天下》玄幻小说"
# → project_id: zongheng
```

## 错误处理

### 错误1: 缺少类型参数

```
错误: 请指定小说类型和流派
用法: /nw-bp-plan [pool_name] <类型> <流派>
示例: /nw-bp-plan 玄幻 废柴流
```

### 错误2: 素材池不存在

```
警告: pools/xuanhuan_1 不存在
将不使用参考风格，基于知识库生成蓝图

继续? [Y/n]
```

### 错误3: 蓝图已存在

```
警告: blueprints/xuanhuan_001 已存在
选项:
  [1] 覆盖现有蓝图
  [2] 使用新 project_id (xuanhuan_002)
  [3] 取消
```

## 知识库匹配

根据关键词自动加载对应知识库：

| 关键词 | 加载知识库 |
|--------|-----------|
| 玄幻/网文/修仙/系统流 | chinese-webnovel/ |
| 异世界/轻小说/转生 | japanese-lightnovel/ |
| fantasy/epic/magic | western-fantasy/ |

## 注意事项

1. **素材可选**：没有参考素材也可以生成蓝图
2. **可编辑**：生成后可手动调整任何蓝图文件
3. **增量生成**：可以单独重新生成某个部分（如只重新生成大纲）
4. **知识驱动**：质量取决于知识库的丰富程度

## 相关命令

- `/nw-scan` - 扫描分析素材池（可选前置步骤）
- `/nw-bp-audit` - 审核蓝图质量
- `/nw-ch-write` - 批量创作章节

---

**提示**: 执行此命令后进入蓝图阶段，可直接通过对话修改蓝图内容，无需重复输入命令。
