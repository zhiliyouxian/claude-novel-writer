# CLAUDE.md

本文件为当前小说创作项目的工作指南。

---

## 项目信息

- **项目ID**: {project_id}
- **创建时间**: {created_date}
- **工作区位置**: {workspace_path}

---

## project_id 命名规范

每个小说项目必须有唯一的 project_id，用于区分不同作品的文件路径。

| 规则 | 说明 | 示例 |
|------|------|------|
| 格式 | 小写字母、数字、下划线 | `my_novel_01` |
| 长度 | 3-30 字符 | ✅ `dao` ❌ `a` |
| 语义 | 有意义的简短名称 | `urban_rebirth` |
| 禁止 | 中文、空格、特殊字符 | ❌ `我的小说` |

**确定 project_id 的规则**：
1. 如果你明确指定项目名（如"创作《纵横天下》"），使用拼音或英文：`zongheng`
2. 如果工作区只有一个蓝图，自动使用该蓝图的目录名
3. 如果工作区有多个蓝图，需要指定使用哪个
4. 如果没有指定且没有蓝图，使用默认名 `novel_001`

---

## 目录结构

```
{workspace_path}/
├── pools/                      # 素材池（放入参考小说）
│   ├── {pool_name}/           # 素材目录
│   └── analysis/              # 分析报告
│
├── blueprints/                 # 蓝图（企划书）
│   └── {project_id}/          # 本项目蓝图
│       ├── proposal.md        # 选题方案
│       │
│       ├── worldview.md       # 世界观总览
│       └── worldview/         # 世界观模块（按需细化）
│       │   ├── power-system.md    # 力量体系
│       │   ├── factions.md        # 势力
│       │   ├── geography.md       # 地理
│       │   ├── history.md         # 历史
│       │   └── rules.md           # 规则
│       │
│       ├── characters.md      # 角色总览
│       └── characters/        # 角色档案（按需细化）
│       │   └── character-{角色名}.md
│       │
│       ├── outline.md         # 大纲框架
│       └── outlines/          # 分卷大纲（按需细化）
│           ├── vol-1.md
│           └── ...
│
├── productions/                # 制作中的章节
│   └── {project_id}/          # 本项目制作目录
│       ├── blueprint.link     # 链接到蓝图
│       ├── chapters/          # 章节文件（重要！）
│       │   ├── chapter-0001.md
│       │   └── ...
│       └── data/
│           └── entities.md    # 实体库
│
└── releases/                   # 导出成品
    └── {project_id}/
        ├── reviews/           # 审核报告
        ├── text/              # TXT版
        └── audio/             # TTS版
```

---

## 常用命令

| 命令 | 功能 |
|------|------|
| `/nw-scan {pool_name}` | 分析素材池 |
| `/nw-bp-plan {pool_name} {类型} {流派}` | 生成蓝图 |
| `/nw-bp-audit` | 审核蓝图 |
| `/nw-ch-write 1-10` | 批量创作章节 |
| `/nw-ch-audit 1-10` | 审核章节 |
| `/nw-release {格式}` | 导出发布 |

---

## 自然语言操作

除了使用命令，你也可以用自然语言直接对话触发相应功能：

### 策划阶段

| 说法 | 触发功能 |
|------|----------|
| "帮我设计世界观" / "创建力量体系" | 世界观设计 |
| "细化力量体系" / "细化势力关系" | 细化世界观模块 |
| "设计角色" / "创建角色档案" | 角色设计 |
| "细化主角" / "详细设计某角色" | 细化角色档案 |
| "写大纲" / "规划剧情" | 大纲设计 |
| "细化第一卷" | 细化分卷大纲 |
| "检查蓝图" / "审核策划" | 蓝图验证 |

### 创作阶段

| 说法 | 触发功能 |
|------|----------|
| "开始创作" / "进入制作阶段" | 初始化制作 |
| "写第1章" / "创作1-10章" | 章节创作 |
| "继续写" / "写下一章" | 续写 |
| "审核章节" / "检查质量" | 章节审核 |
| "重写第3章" / "修改这几章" | 章节修订 |

### 发布阶段

| 说法 | 触发功能 |
|------|----------|
| "导出TXT" / "导出所有章节" | 格式导出 |
| "生成有声书" / "TTS导出" | 音频导出 |
| "检查一致性" | 一致性检查 |
| "检查乱码" / "检查编码" | 编码检查 |

### 实体管理

| 说法 | 触发功能 |
|------|----------|
| "全局替换XX为YY" | 实体替换 |
| "添加别名" | 别名管理 |
| "检查实体冲突" | 冲突检测 |

---

## 分层蓝图说明

蓝图采用**总览+详细**的分层结构，支持按需细化：

| 文件 | 内容 | 细化指令 |
|------|------|----------|
| `worldview.md` | 世界观总览 | "细化力量体系/势力/地理/历史/规则" |
| `characters.md` | 角色列表和关系网 | "细化{角色名}" |
| `outline.md` | 大纲框架和卷划分 | "细化第X卷" |

**工作流程**：
1. 先生成总览文件（worldview.md, characters.md, outline.md）
2. 按需细化模块/角色/分卷
3. chapter-writer 读取总览 + 按需读取详细文件

---

## 注意事项

1. **章节位置**：所有章节文件必须在 `productions/{project_id}/chapters/` 目录下
2. **实体库**：位于 `productions/{project_id}/data/entities.md`，创作时自动维护
3. **书写规范**：使用中文标点、阿拉伯数字（年龄/境界/数量）、段落空行分隔
4. **命名格式**：章节文件命名为 `chapter-{0001}.md`（四位数字补零）
5. **分层蓝图**：先生成总览，再按需细化详细文件

---

## 四部门工作流

```
素材池(Pools) → 策划(Blueprints) → 制作(Productions) → 发布(Releases)
```

1. **素材池**：放入参考小说，执行分析
2. **策划**：生成世界观、角色、大纲等蓝图文件
3. **制作**：根据蓝图批量创作章节
4. **发布**：审核、修订、导出成品

---

*由 Novel Writing Studio Plugin 的 `/nw-init` 命令生成*
