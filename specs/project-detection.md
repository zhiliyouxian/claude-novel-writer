# 项目识别规范

所有涉及 `project_id` 的命令和 Agent 都应遵循此规范进行项目识别。

## 识别流程

```
确定 project_id:
  ↓
1. 检查对话上下文
   ├─ 用户明确提及项目名 → 使用该项目
   │   示例: "继续写纵横天下" → zongheng
   │   示例: "审核 xuanhuan_001" → xuanhuan_001
   └─ 未提及 → 继续步骤2
  ↓
2. 扫描工作区项目
   检查 productions/ 目录下的项目数量
   ├─ 0个项目 → 提示先创建蓝图
   ├─ 1个项目 → 自动使用该项目
   └─ 多个项目 → 继续步骤3
  ↓
3. 多项目时询问用户
   列出所有项目及状态，请用户选择
  ↓
4. 记住选择
   本次会话后续命令默认使用已选项目
   （除非用户明确切换）
```

## 扫描项目的方法

```bash
# 扫描 productions/ 下的项目
ls productions/

# 获取项目信息
# 每个项目目录下的 blueprint.link 指向对应蓝图
# 可以从蓝图中读取书名等信息
```

## 项目状态显示

询问时应显示有用的项目信息：

```
检测到多个项目:

  1. zongheng
     书名: 《纵横天下》
     进度: 已完成 30/200 章 (15%)
     最后更新: 2024-01-15

  2. xuanhuan_001
     书名: 《万古签到系统》
     进度: 已完成 10/210 章 (5%)
     最后更新: 2024-01-14

请选择要操作的项目 [1/2]:
```

## 0个项目时的提示

```
⚠️ 当前工作区没有创作项目

请先创建蓝图:
  /nw-plan 玄幻 废柴流

或者如果已有蓝图，初始化制作:
  查看蓝图: ls blueprints/
```

## 上下文识别示例

| 用户输入 | 识别结果 |
|----------|----------|
| "/nw-write 1-10" | 检查项目数量 |
| "继续写纵横天下第11章" | → zongheng |
| "审核万古签到的前10章" | → xuanhuan_001 (从书名匹配) |
| "把 xuanhuan_001 导出" | → xuanhuan_001 |
| "写下一批章节" | 使用上次选择的项目 |

## 会话记忆

在同一会话中，一旦确定了项目，后续命令应默认使用该项目：

```
用户: /nw-write 1-10
AI: 检测到多个项目...选择项目 [1/2]:
用户: 1
AI: ✅ 已选择项目 zongheng，开始创作...

（后续）
用户: /nw-review 1-10
AI: 审核项目 zongheng 的第1-10章...  ← 自动使用上次选择
```

## 切换项目

用户可以通过明确指定来切换：

```
用户: "切换到 xuanhuan_001"
用户: "审核万古签到"
用户: "操作另一个项目"  ← 触发重新询问
```

## 适用范围

以下命令/Agent 需要遵循此规范：

**命令**:
- `/nw-write` - 创作章节
- `/nw-review` - 审核章节
- `/nw-export` - 导出章节

**Agent**:
- chapter-writer
- chapter-auditor
- revision-writer
- entity-manager
- production-initializer
